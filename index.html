<!doctype html>
<html lang="pl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Wydatki miesiƒôczne</title>

  <!-- Ikony / manifest -->
  <link rel="icon" href="favicon.ico">
  <link rel="icon" sizes="192x192" href="icon-192.png">
  <link rel="icon" sizes="512x512" href="icon-512.png">
  <link rel="apple-touch-icon" href="icon-192.png">
  <link rel="manifest" href="manifest.json">

  <style>
    body {
      margin: 0;
      font-family: system-ui, "Segoe UI", Roboto, sans-serif;
      background: linear-gradient(180deg, #f7f9ff 0%, #eef2ff 100%);
      color: #0f172a;
    }
    .wrap { max-width: 980px; margin: 24px auto; padding: 0 16px; }
    .toolbar {
      display: flex; gap: 10px; flex-wrap: wrap; align-items: center;
      background: #fff; border: 1px solid #e6e8f0; border-radius: 12px;
      padding: 10px 12px; box-shadow: 0 4px 12px rgba(0,0,0,.05);
      margin-bottom: 16px;
    }
    .toolbar .spacer { flex: 1; }
    .btn {
      padding: 8px 12px; border: 1px solid #ccc; border-radius: 8px;
      background: #fff; cursor: pointer; transition: .2s;
    }
    .btn.primary { background: #0ea5e9; border-color: #0ea5e9; color: #fff; }
    .btn.ok { background: #16a34a; border-color: #16a34a; color: #fff; }
    .btn:hover { transform: translateY(-1px); box-shadow: 0 4px 10px rgba(0,0,0,.1); }

    .controls label { margin-right: 8px; display: inline-flex; align-items: center; gap: 6px; }
    .controls input, .controls select {
      padding: 5px 8px; border: 1px solid #ccc; border-radius: 6px; font-size: 14px;
    }

    table { width: 100%; border-collapse: collapse; margin-top: 12px; background: #fff; border-radius: 10px; overflow: hidden; }
    th, td { border: 1px solid #ddd; padding: 6px 8px; font-size: 13px; }
    th { background: #f3f4f6; text-align: center; font-weight: 600; }
    td input, td select {
      width: 100%; border: 1px solid #ccc; border-radius: 6px;
      padding: 4px 6px; box-sizing: border-box; font-size: 13px;
    }

    .small { font-size: 12px; color: #64748b; text-align: center; }
    #footerApp { margin-top: 10px; text-align: center; font-size: 12px; color: #64748b; }

    @media print {
      body { font-family: "Times New Roman", Times, serif; font-size: 11px; background: #fff; }
      .no-print { display: none !important; }
      th, td { border: 1px solid #000; padding: 3px 5px; font-size: 10px; }
      #footerApp { display: none; }
      #pdfFooter { display: block; text-align: center; font-size: 10px; margin-top: 6px; }
      @page { size: A4 portrait; margin: 8mm; }
    }
  </style>

  <script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>
</head>
<body>
<div class="wrap">
  <div class="toolbar no-print">
    <h1 style="margin:0;font-size:18px">Wydatki miesiƒôczne</h1>
    <div class="spacer"></div>
    <button class="btn primary" id="btnPdf">Eksportuj do PDF</button>
    <button class="btn ok" id="btnExcel">Eksportuj do Excela</button>
    <button class="btn" id="btnClear">Wyczy≈õƒá dane</button>
  </div>

  <div class="controls no-print">
    <label>Imiƒô i nazwisko: <input type="text" id="name" placeholder="np. Jan Kowalski"></label>
    <label>Rok: <input type="number" id="year" style="width:100px"></label>
    <label>MiesiƒÖc:
      <select id="month">
        <option value="0">Stycze≈Ñ</option><option value="1">Luty</option><option value="2">Marzec</option>
        <option value="3">Kwiecie≈Ñ</option><option value="4">Maj</option><option value="5">Czerwiec</option>
        <option value="6">Lipiec</option><option value="7">Sierpie≈Ñ</option><option value="8">Wrzesie≈Ñ</option>
        <option value="9">Pa≈∫dziernik</option><option value="10">Listopad</option><option value="11">Grudzie≈Ñ</option>
      </select>
    </label>
    <button class="btn" id="addRow">‚ûï Dodaj wiersz</button>
  </div>

  <div class="section">
    <h2 style="text-align:center;margin:6px 0;">Podsumowanie wydatk√≥w ‚Äì <span id="headerMonth"></span> <span id="headerYear"></span></h2>
    <div style="text-align:center" class="small">Imiƒô i nazwisko: <span id="headerName">............................................</span></div>
    <table id="mainTable">
      <thead>
        <tr>
          <th style="width:60px">Dzie≈Ñ</th>
          <th>Miejsce tankowania</th>
          <th style="width:90px">Litry</th>
          <th style="width:110px">Kwota tankowania</th>
          <th>Inne wydatki</th>
          <th style="width:110px">Kwota</th>
          <th class="no-print" style="width:60px">Akcje</th>
        </tr>
      </thead>
      <tbody id="tableBody"></tbody>
    </table>
  </div>

  <div id="footerApp">Tw√≥rcy: ≈Åukasz Stasinski &amp; ChatGPT ‚Ä¢ <span id="genDate"></span></div>
  <div id="pdfFooter" style="display:none;">LS &amp; GPT</div>
</div>

<script>
const LS_KEY = "wydatkiOneTable";
let state = { name:"", year:new Date().getFullYear(), month:new Date().getMonth(), rows:[] };

function saveState(){ localStorage.setItem(LS_KEY, JSON.stringify(state)); }
function loadState(){
  const raw = localStorage.getItem(LS_KEY);
  if(raw){ try{ state = JSON.parse(raw); }catch(e){} }
}

function sortByDay(){ state.rows.sort((a,b)=>Number(a.day||0)-Number(b.day||0)); }

const DAY_OPTIONS = Array.from({length:31},(_,i)=>`<option value="${i+1}">${i+1}</option>`).join("");

function render(){
  document.getElementById('name').value = state.name;
  document.getElementById('year').value = state.year;
  document.getElementById('month').value = state.month;
  renderHeader();
  renderTable();
}

function renderHeader(){
  const months=["stycze≈Ñ","luty","marzec","kwiecie≈Ñ","maj","czerwiec","lipiec","sierpie≈Ñ","wrzesie≈Ñ","pa≈∫dziernik","listopad","grudzie≈Ñ"];
  document.getElementById('headerMonth').textContent=months[state.month];
  document.getElementById('headerYear').textContent=state.year;
  document.getElementById('headerName').textContent=state.name||"............................................";
}

function renderTable(){
  sortByDay();
  const body=document.getElementById('tableBody');
  body.innerHTML="";
  if(state.rows.length===0){
    body.innerHTML=`<tr><td colspan="7" class="small">Brak wpis√≥w ‚Äì kliknij "Dodaj wiersz".</td></tr>`;
    return;
  }
  state.rows.forEach((r,i)=>{
    const tr=document.createElement("tr");
    tr.innerHTML=`
      <td><select data-idx="${i}" data-field="day"><option value=""></option>${DAY_OPTIONS}</select></td>
      <td><input type="text" data-idx="${i}" data-field="place" value="${r.place??""}"></td>
      <td><input type="text" data-idx="${i}" data-field="liters" value="${r.liters??""}"></td>
      <td><input type="text" data-idx="${i}" data-field="fuelAmount" value="${r.fuelAmount??""}"></td>
      <td><input type="text" data-idx="${i}" data-field="otherName" value="${r.otherName??""}"></td>
      <td><input type="text" data-idx="${i}" data-field="otherAmount" value="${r.otherAmount??""}"></td>
      <td class="no-print"><button class="btn" data-del="${i}">üóë</button></td>`;
    body.appendChild(tr);
    tr.querySelector("select").value=r.day??"";
  });
}

document.getElementById('addRow').onclick=()=>{
  state.rows.push({day:"",place:"",liters:"",fuelAmount:"",otherName:"",otherAmount:""});
  saveState(); renderTable();
};

document.addEventListener("input",e=>{
  const t=e.target;
  const idx=t.dataset.idx;
  const field=t.dataset.field;
  if(idx!==undefined && field){
    if(field==="day") state.rows[idx][field]=t.value===""?"":parseInt(t.value);
    else state.rows[idx][field]=t.value;
    saveState(); renderTable();
  }
});

document.addEventListener("click",e=>{
  const t=e.target;
  if(t.dataset.del!==undefined){
    state.rows.splice(t.dataset.del,1);
    saveState(); renderTable();
  }
});

document.getElementById("name").oninput=()=>{ state.name=document.getElementById("name").value; saveState(); renderHeader(); };
document.getElementById("year").oninput=()=>{ state.year=parseInt(document.getElementById("year").value)||new Date().getFullYear(); saveState(); renderHeader(); };
document.getElementById("month").oninput=()=>{ state.month=parseInt(document.getElementById("month").value); saveState(); renderHeader(); renderTable(); };

document.getElementById("btnPdf").onclick=()=>window.print();

document.getElementById("btnExcel").onclick=()=>{
  const wb=XLSX.utils.book_new();
  const data=[["Dzie≈Ñ","Miejsce tankowania","Litry","Kwota tankowania","Inne wydatki","Kwota"]];
  sortByDay();
  state.rows.forEach(r=>{
    if(r.day||r.place||r.liters||r.fuelAmount||r.otherName||r.otherAmount)
      data.push([r.day||"",r.place||"",r.liters||"",r.fuelAmount||"",r.otherName||"",r.otherAmount||""]);
  });
  XLSX.utils.book_append_sheet(wb,XLSX.utils.aoa_to_sheet(data),"Wydatki");
  const m=String(state.month+1).padStart(2,"0");
  XLSX.writeFile(wb,`Wydatki_${state.year}_${m}.xlsx`);
};

document.getElementById("btnClear").onclick=()=>{
  if(confirm("Czy na pewno chcesz usunƒÖƒá wszystkie dane?")){
    localStorage.removeItem(LS_KEY);
    state={name:"",year:new Date().getFullYear(),month:new Date().getMonth(),rows:[]};
    render();
  }
};

(function start(){
  loadState(); render();
  const d=new Date();
  document.getElementById("genDate").textContent=`Wygenerowano: ${d.toLocaleDateString("pl-PL")} ${d.toLocaleTimeString("pl-PL",{hour:"2-digit",minute:"2-digit"})}`;
})();
</script>

<!-- Service Worker -->
<script>
if('serviceWorker' in navigator){
  navigator.serviceWorker.register('sw.js').then(()=>console.log("SW ok"));
}
</script>
</body>
</html>
